tinymce.PluginManager.add('imgpopup', function(editor, url) {
  // Add a button that opens a window
  editor.addButton('imgpopup', {
    text: 'Image Popup',
    icon: false,
    onclick: function() {
      // Open window
      editor.windowManager.open({
        title: 'Image Popup',
        body: [
          {type: 'filepicker', name: 'imglink', label: 'Image'}
        ],
        onsubmit: function(e) {
          // Insert content when the window form is submitted
          editor.insertContent('<a class="fancybox" rel="fancybox-thumb" href="'+ e.data.imglink+'"><img src="'+ e.data.imglink+'"></a>');
		  
        }
      });
    }
  });

  // Adds a menu item to the tools menu
  editor.addMenuItem('imgpopup', {
    text: 'Image Popup',
    context: 'tools',
    onclick: function() {
      // Open window with a specific url
      editor.windowManager.open({
        title: 'Image Popup',
        url: 'https://www.tinymce.com',
        width: 800,
        height: 600,
        buttons: [{
          text: 'Close',
          onclick: 'close'
        }]
      });
    }
  });

  return {
    getMetadata: function () {
      return  {
        title: "Example plugin",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
});